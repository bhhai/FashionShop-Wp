!function(){"use strict";var __webpack_require__={n:function(module){var getter=module&&module.__esModule?function(){return module.default}:function(){return module};return __webpack_require__.d(getter,{a:getter}),getter},d:function(exports,definition){for(var key in definition)__webpack_require__.o(definition,key)&&!__webpack_require__.o(exports,key)&&Object.defineProperty(exports,key,{enumerable:!0,get:definition[key]})},o:function(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}},external_MailPoet_namespaceObject=MailPoet,external_MailPoet_default=__webpack_require__.n(external_MailPoet_namespaceObject),external_jQuery_namespaceObject=jQuery,external_jQuery_default=__webpack_require__.n(external_jQuery_namespaceObject),mp2migrator_MailPoet=external_MailPoet_default();mp2migrator_MailPoet.MP2Migrator={fatal_error:"",is_logging:!1,startLogger:function(){mp2migrator_MailPoet.MP2Migrator.is_logging=!0,clearTimeout(mp2migrator_MailPoet.MP2Migrator.displayLogs_timeout),clearTimeout(mp2migrator_MailPoet.MP2Migrator.updateProgressbar_timeout),clearTimeout(mp2migrator_MailPoet.MP2Migrator.update_wordpress_info_timeout),setTimeout(mp2migrator_MailPoet.MP2Migrator.updateDisplay,1e3)},stopLogger:function(){mp2migrator_MailPoet.MP2Migrator.is_logging=!1},updateDisplay:function(){mp2migrator_MailPoet.MP2Migrator.displayLogs(),mp2migrator_MailPoet.MP2Migrator.updateProgressbar()},displayLogs:function(){external_jQuery_default().ajax({url:window.mailpoet_mp2_migrator.log_file_url,cache:!1}).done((function(result){external_jQuery_default()("#logger").html(""),result.split("\n").forEach((function(resultRow){var row=resultRow;"[ERROR]"===row.substr(0,7)||"[WARNING]"===row.substr(0,9)||row.toLowerCase()===mp2migrator_MailPoet.I18n.t("import_stopped_by_user").toLowerCase()?row='<span class="error_msg">'+row+"</span>":row.toLowerCase()===mp2migrator_MailPoet.I18n.t("import_complete").toLowerCase()&&(external_jQuery_default()("#import-actions").hide(),external_jQuery_default()("#upgrade-completed").show()),external_jQuery_default()("#logger").append(row+"<br />\n")})),external_jQuery_default()("#logger").append('<span class="error_msg">'+mp2migrator_MailPoet.MP2Migrator.fatal_error+"</span><br />\n")})).always((function(){mp2migrator_MailPoet.MP2Migrator.is_logging&&(mp2migrator_MailPoet.MP2Migrator.displayLogs_timeout=setTimeout(mp2migrator_MailPoet.MP2Migrator.displayLogs,1e3))}))},updateProgressbar:function(){external_jQuery_default().ajax({url:window.mailpoet_mp2_migrator.progress_url,cache:!1,dataType:"json"}).always((function(result){var progress=0;void 0!==result.total&&0!==Number(result.total)&&(progress=Math.round(Number(result.current)/Number(result.total)*100)),external_jQuery_default()("#progressbar").progressbar("option","value",progress),external_jQuery_default()("#progresslabel").html(progress+"%"),0!==Number(result.current)&&(external_jQuery_default()("#skip-import").hide(),external_jQuery_default()("#progressbar").show(),external_jQuery_default()("#logger-container").show()),mp2migrator_MailPoet.MP2Migrator.is_logging&&(mp2migrator_MailPoet.MP2Migrator.updateProgressbar_timeout=setTimeout(mp2migrator_MailPoet.MP2Migrator.updateProgressbar,1e3))}))},startImport:function(){return mp2migrator_MailPoet.MP2Migrator.fatal_error="",mp2migrator_MailPoet.MP2Migrator.startLogger(),mp2migrator_MailPoet.MP2Migrator.import_button_label=external_jQuery_default()("#import").val(),external_jQuery_default()("#import").val(mp2migrator_MailPoet.I18n.t("importing")).attr("disabled","disabled"),external_jQuery_default()("#skip-import").hide(),external_jQuery_default()("#stop-import").show(),mp2migrator_MailPoet.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"MP2Migrator",action:"import",data:{}}).always((function(){mp2migrator_MailPoet.MP2Migrator.stopLogger(),mp2migrator_MailPoet.MP2Migrator.updateDisplay(),mp2migrator_MailPoet.MP2Migrator.reactivateImportButton()})).done((function(response){response&&(mp2migrator_MailPoet.MP2Migrator.fatal_error=response.data)})).fail((function(response){response.errors.length>0&&mp2migrator_MailPoet.Notice.error(response.errors.map((function(error){return error.message})),{scroll:!0})})),!1},reactivateImportButton:function(){external_jQuery_default()("#import").val(mp2migrator_MailPoet.MP2Migrator.import_button_label).removeAttr("disabled"),external_jQuery_default()("#stop-import").hide()},stopImport:function(){return external_jQuery_default()("#stop-import").attr("disabled","disabled"),mp2migrator_MailPoet.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"MP2Migrator",action:"stopImport",data:{}}).always((function(){external_jQuery_default()("#stop-import").removeAttr("disabled"),mp2migrator_MailPoet.MP2Migrator.reactivateImportButton(),mp2migrator_MailPoet.MP2Migrator.updateDisplay()})).fail((function(response){response.errors.length>0&&mp2migrator_MailPoet.Notice.error(response.errors.map((function(error){return error.message})),{scroll:!0})})),mp2migrator_MailPoet.MP2Migrator.stopLogger(),!1},skipImport:function(){return mp2migrator_MailPoet.Ajax.post({api_version:window.mailpoet_api_version,endpoint:"MP2Migrator",action:"skipImport",data:{}}).done((function(){mp2migrator_MailPoet.MP2Migrator.gotoWelcomePage()})).fail((function(response){response.errors.length>0&&mp2migrator_MailPoet.Notice.error(response.errors.map((function(error){return error.message})),{scroll:!0})})),!1},gotoWelcomePage:function(){return window.location.href="admin.php?page=mailpoet-welcome-wizard",!1}},external_jQuery_default()((function(){external_jQuery_default()("#progressbar").progressbar({value:0}),external_jQuery_default()("#import").on("click",(function(){mp2migrator_MailPoet.MP2Migrator.startImport()})),external_jQuery_default()("#stop-import").on("click",(function(){mp2migrator_MailPoet.MP2Migrator.stopImport()})),external_jQuery_default()("#skip-import").on("click",(function(){mp2migrator_MailPoet.MP2Migrator.skipImport()})),external_jQuery_default()("#goto-welcome").on("click",(function(){mp2migrator_MailPoet.MP2Migrator.gotoWelcomePage()})),mp2migrator_MailPoet.MP2Migrator.updateDisplay()}))}();